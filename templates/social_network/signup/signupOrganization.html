{% extends "base/base.html" %}

{% load i18n %}
{% load socialNetworkTags %}

{% block form %}<form id="Form1" action="doSome" method="post">{% endblock %}

{% block js %}

<script type="text/javascript" src="{{settings.MEDIA_URL}}js/json2.js"></script>

<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.passStrengthener.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.bubblepopup.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.metadata.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.form.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.validate.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.jsonSuggest.js"></script>

<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.container.js"></script>

<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.networkIcon.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.loading.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.tagContainer.js"></script>
<script type="text/javascript" src="{{settings.MEDIA_URL}}js/ximpia-plugins/ximpia.textAreaExtra.js"></script>

<script type="text/javascript" src="http://connect.facebook.net/en_US/all.js"></script>

<!-- Facebook Button -->
<div id="fb-root"></div>
<!-- Facebook Button -->

{% endblock %}

{% block jquery %}

	// Start jquery code
    var formId = "Form1";
    doShowPasswordStrength('id_ximpiaId', 'id_password', 'id_' + formId + '_Submit');
    doBindBubbles();
        
    // Form1
    doBindSubmitForm(formId);
    
    // reloadCaptcha
    doReloadCaptcha();
	
    // fadeIcons    
    fadeIcons();    

	// Facebook logic
    var fbAppId = $("#id_facebookAppId").attr('value');
    FB.init({appId: fbAppId, status: true, cookie: true, xfbml: true});
  	FB.Event.subscribe('auth.sessionChange', function(response) {
    	if (response.session) {
    		// A user has logged in, and a new cookie has been saved			
			
			var facebookList = JSON.parse($("#id_facebookIcon_data").attr('value'));
			facebookList[1].token = response.session.access_token;
			$("#id_facebookIcon_data").attr('value', JSON.stringify(facebookList));
			
			// Hide passwords
			$("#id_showPassword").css('display','none');
			$("#id_password").css('display','none');
			$("#id_passwordVerify").css('display','none');
			$("#id_password").removeClass('required');
			$("#id_passwordVerify").removeClass('required');
			// Get profile
			FB.api('/me', function(responseProfile) {
				// Fillout fields in form
				$("#id_firstName").attr('value', responseProfile.first_name);
				$("#id_lastName").attr('value', responseProfile.last_name);
				$("#id_email").attr('value', responseProfile.email);
				$("#id_ximpiaId").attr('value', responseProfile.first_name.toLowerCase() + '.' + responseProfile.last_name.toLowerCase());
				var locationName = responseProfile.location.name;
				var locationFields = locationName.split(',');
				$("#id_city").attr('value', locationFields[0].trim());
				var locale = responseProfile.locale;
				$("#id_country").attr('value', locale.split('_')[1].toLowerCase());
				$("#id_facebookIcon").xpSocialNetworkIcon('changeStatusOK');
			});			
    	} else {
    		// The user has logged out, and the cookie has been cleared
			//alert('Out....');
    	}
	});	

	// Suggest for job title and organization group
	$('#id_jobTitle').jsonSuggest({data: $('#id_jobTitle_data').attr('value'), maxHeight: 200, minCharacters:3});
	$('#id_organizationGroup').jsonSuggest({data: $('#id_organizationGroup_data').attr('value'), maxHeight: 200, minCharacters:3}); 	
	// Remote Suggest Tags
	var url = '/jxSuggestList?action=' + 'TagDAO.filter' + ';' + 'params=' + JSON.stringify({'text': 'name__icontains', 'isPublic': true});
	$('#id_organizationGroupTags').jsonSuggest({url: url, maxHeight: 200, minCharacters: 3});
	
	var container = $("#id_groupTags").xpContainer({limit: 10, doKey: true, args: {idText: 'id_organizationGroupTags', button: 'BtAddTag'}});
	container.xpContainer('addTag');

	// Social Network Icons	
	$(".AuthIcon").xpSocialNetworkIcon();
	$(".AuthIcon").click(function() {
	   $(this).xpSocialNetworkIcon('click');
	});	
	
	$(".TextArea").xpTextAreaExtra();

{% endblock %}

{% block title %}Ximpia - {% trans "Organization Signup" %}{% endblock %}

{% block app %}

    <div id="app_Site" style="width: 100%; border: 0px solid" >
	
	<table id="SearchPadding"><tr><td style="width: 700px; padding-left: 30px;">
	
	{% if show_message %}
	<div id="ErrorMessage" style="background-color:#DDDDDD; padding:20px"><b>Message</b></div>
	{% endif %}

    <h3>XimpiaId</h3>
    
    You can authenticate with password or sign up with Facebook. In the case of Facebook auth you will not need to validate your email.<br/><br />
    
    <table cellspacing="0" cellpadding="0"><tr><td style="vertical-align:top;">
    <div class="FormBlock">
    <label for="id_ximpiaId">XimpiaId: {{form.ximpiaId}} <br />
    <div id="id_showPassword">
    {% if not auth.facebook %}
    <label for="id_password">{% trans "Password" %}: {{form.password}} <br/>
    <label for="id_passwordVerify">{% trans "Password Verify" %}: {{form.passwordVerify}} <br />
    {% endif %}
    </div>
    </div>
    </td>

    <td style="width: 50px"></td>
    <td style="background-color:#000000; width: 1px"> <img src="{{settings.MEDIA_URL}}images/blank.png" /></td>
    <td style="width: 50px"></td>   
	
    <td style="vertical-align:top;">
    
    <div id="id_socialNetworkSignupButtonsZone">
        
        <div id="id_fbLoginButton">
            <fb:login-button perms="{{settings.FACEBOOK_SCOPE}}" show_faces="true"></fb:login-button>
        </div>              
    
    </div>  
        
    </td>
    
    </tr></table>

	<div id="UserData">	
	
	<h3>{% trans "You" %}</h3>
	
    <div id="Info" class="FormBlock">
    <table border="0"><tr><td style="vertical-align: top">
    <label for="id_firstName">{% trans "First Name" %}: {{form.firstName}}<br />
    <label for="id_lastName">{% trans "Last Name" %}: {{form.lastName}}<br />
    <label for="id_email">Email: {{form.email}}<br />

    </td>
    <td style="vertical-align: top; padding-left: 50px">
    <label for="id_city">{% trans "City" %}: {{form.city}}<br />
    <label for="id_country">{% trans "Country" %}: {{form.country}}<br />       
    </td>
    </tr>
	</table>
    
    </div>
	
	<h3>{% trans "Your Organization And You" %}</h3>
	<div id="OrgYouInfo" class="FormBlock">
		 <label for="id_jobTitle">{% trans "Job Title" %}: {{form.jobTitle}}<br />
		 <label for="id_organizationGroup">{% trans "Group You Manage" %}: {{form.organizationGroup}}<br />
		 
		 <table border="0">
		 	<tr>
		 		<td>
		 			<label for="id_organizationGroupTags">{% trans "Group Tags" %}: {{form.organizationGroupTags}}
				</td><td>		 
		 <input id="BtAddTag" type="button" value="Add" />
		 </td><td valign="bottom" >
		 	
		 <div id="id_groupTags" class="tagContainer">
		 </div>
		 
		 </td></tr></table>
		 
	</div>
	
	<h3>{% trans "Your Organization" %}</h3>
	
	<div id="OrgInfo" class="FormBlock">
		<table border="0"><tr><td style="vertical-align: top">
		<label for="id_account">{% trans "Account" %}: {{form.account}}<br />				
		<label for="id_organizationName">{% trans "Organization Name" %}: {{form.organizationName}}<br />
		<label for="id_organizationDomain">{% trans "Domain" %}: {{form.organizationDomain}}<br />
		<label for="id_organizationCity">{% trans "City" %}: {{form.organizationCity}}<br />
		<label for="id_organizationCountry">{% trans "Country" %}: {{form.organizationCountry}}<br />
		<table><tr><td><label for="id_description">{% trans "Description" %}:<br/> {{form.description}}<br />
		</td><td valign="bottom" style="width: 30px"><span id="id_description_counter" class="TextAreaCounter" style=" font-size:90%; position:relative; top: 7px"></span></td></tr></table>
        </td>
        <td style="vertical-align: top; padding-left: 0px">
        <label for="id_organizationIndustry">{% trans "Industry" %}: {{form.organizationIndustry}}<br />
		</td></tr></table>
	</div>	

{% comment %}
    <h3>{% trans "Your Networks" %}</h3>
    <div id="SocialNetworks" class="FormBlock">
        You can also link your user to your professional networks.
    <table>
        <tr>
          <td>
            {% socialNetworkIcon "facebook" auth %}         
          </td>
          <td>
            {% socialNetworkIcon "linkedin" auth %}
          </td>
          <td>
            {% socialNetworkIcon "twitter" auth %}
          </td>       
        </tr>
    </table>
	
	And for your organization:<br/>
    <table>
        <tr>
          <td>
            {% socialNetworkIcon "twitter" auth %}
          </td>       
        </tr>
    </table>
    
    </div>
{% endcomment %}

{% comment %}	
    {% if showInvitation %}
    <h3>{% trans "Invitation" %}</h3>
    <div id="Invitation" class="FormBlock">
        <label for="id_invitationCode">{% trans "Invitation Code" %}: {{form.invitationCode}}
    </div>
    {% endif %}
    
    {% if not showInvitation %}
    <h3>{% trans "Validation" %}</h3>
    {% captcha %}
    {% endif %}
{% endcomment %}
	
    {% signupButtonBar "{idForm: 'id_Form1'}" %}
	
	</td>
		
	</tr>
	</table>
    
    </div>
    <!-- End app_MyApp -->

{% endblock %}
