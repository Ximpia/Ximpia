{% extends "base/base.html" %}

{% load i18n %}

{% block form %}<form id="Form1" action="" method="post">{% endblock %}

{% block js %}

<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.passStrengthener.js"></script>
<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.bubblepopup.v2.3.1.min.js"></script>
<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.metadata.js"></script>
<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.form.js"></script>
<script type="text/javascript" src="/site_media/js/jquery-plugins/jquery.validate.js"></script>

<script language="JavaScript">

$(document).ready(function(){

	function showPasswordStrength(userId, passwordId, submitId) {
		// Password Strength
		$("#" + passwordId).passStrengthener({
					userid:	"#" + userId,
					strengthCallback:function(score, strength)
						{						
							if(strength == 'good' || strength == 'strong')
							{
								$("#" + submitId).removeAttr('disabled');
							}
							else
							{
								$("#" + submitId).attr('disabled', 'disabled')
							}
						}
				});			
	}
		
	function submitForm(formId, callbackFunction) {
		$(".submit").click(function() {
			var isValid = $("#" + formId).valid();
			var idImg = 'id_' + formId + '_Submit_Status';
			var idTxt = 'id_' + formId + '_Submit_Text';
			if (isValid == true) {
				// OK
				$("#" + formId).submit();
			} else {
				// Format errors
				$("#" + idImg).addClass('AjaxButtonERROR');
				$("#" + idTxt).text($("#msgError_GEN_VALIDATION").attr('value'));
			}
		});
		$("#" + formId).validate({
			submitHandler: function(form) {
				// Submit form
				var idImg = 'id_' + form.id + '_Submit_Status';
				var idTxt = 'id_' + form.id + '_Submit_Text';
				$("#" + idImg).removeClass('AjaxButton');
				$("#" + idImg).removeClass('AjaxButtonError');
				$("#" + idImg).addClass('AjaxButtonLoading');
				$("#" + idTxt).text('');
				$(form).ajaxSubmit({
					dataType: 'json',
					success: function(response, status) {
						var responseMap = eval(response);
						statusCode = responseMap['status'];
						if (statusCode == 'OK') {
							$("#" + idImg).removeClass('AjaxButtonLoading');
							$("#" + idImg).removeClass('AjaxButtonERROR');
							$("#" + idImg).addClass('AjaxButtonOK');
							$("#" + idTxt).text($("#id_msg_ok").attr('value'));
							// Put all fields inside form valid that are now errors
							$(".error").addClass('valid').removeClass("error");
							// Disable button
							$("#id_" + form.id + '_Submit').attr('disabled', 'disabled')							
							callbackFunction();
						} else {
							$("#" + idImg).removeClass('AjaxButtonLoading');
							$("#" + idImg).addClass('AjaxButtonERROR');
							$("#" + idTxt).text($("#msgError_GEN_VALIDATION").attr('value'));
							// Integrate showMessage, popUp, etc...
							var list = responseMap['errors'];
							message = '<ul>'
							for (var i=0; i<list.length; i++) {
								var errorId = list[i][0];
								var errorMessage = list[i][1];
								//alert(errorId);
								$("#" + errorId).removeClass("valid");
								$("#" + errorId).addClass("error");
								message = message + '<li>' + errorMessage + '</li>';
							}
							message = message + '</ul>';
							// Show error Message in pop up
							showPopUp({
								title: 'Errors Found',
								message: message,
							});
						}
					},
					error: function (data, status, e) {
						$("#" + idImg).removeClass('AjaxButtonLoading');
						showPopUp({
							title: 'System Error',
							message: 'I cannot process your request due to an unexpected error. Sorry for the inconvenience, please retry later. Thanks',
							height: 50
						});
					}
				});
 			},
			errorPlacement: function(error, element) {
				element.next("img table").after(error);
   			}
		});			
	}
	
	function showRemoteError() {
		showPopUp('MessageERROR');
	}
		
	//function showMessage(sTitle, sMessage, sButtons, sEffectIn, sEffectOut, bFadeBackground, iWidth, iHeight, functionShow) {
	function showMessage(messageOptions) {
		var sTitle = '';
		var sMessage = '';
		var sButtons = 'MsgCPClose:Close';
		var sEffectIn = 'fadeIn,1000';
		var sEffectOut = '';
		var bFadeBackground = true;
		var iWidth = null;
		var iHeight = null;
		functionShow = null;
		if (messageOptions.title) sTitle = messageOptions.title;
		if (messageOptions.message) sMessage = messageOptions.message;
		if (messageOptions.buttons) sButtons = messageOptions.buttons;
		if (messageOptions.effectIn) sEffectIn = messageOptions.effectIn;
		if (messageOptions.effectOut) sEffectOut = messageOptions.effectOut;
		if (messageOptions.fadeBackground) bFadeBackground = messageOptions.fadeBackground;
		if (messageOptions.width) iWidth = messageOptions.width;
		if (messageOptions.height) iHeight = messageOptions.height;
		if (messageOptions.functionShow) functionShow = messageOptions.functionShow;
		bFadeOut = checkFadeOut();
		if (!bFadeOut) {
			bFadeBackground = false;
		}
		iScreenWidth = document.body.clientWidth;
		if (iWidth) {
			$("div.PopMessage").css('width', iWidth + 'px');
			$("div#PopMsgWrapper").css('width', iWidth + 'px');
		}
		else {
			$("div.PopMessage").css('width', '450px');
			$("div#PopMsgWrapper").css('width', '450px');
		}
		if (iHeight) {
			$("div.MsgText").css('height', iHeight + 'px');
			var iTopPosition = 80;
		}
		iLeft = (iScreenWidth/2)- parseInt($("div.PopMessage").css('width'))/2;
		if (!$.browser.msie) {
			iTopOffset = window.pageYOffset;
		}
		else {
			iTopOffset = document.documentElement.scrollTop;
		}
		//alert(sMessage.length);
		if (!iHeight) {
			if (sMessage.length <= 100) {
				//var iTopPosition = 160;
				var iTopPosition = 130;
				$("div.MsgText").css('height', '40px');
				$("div.MsgText").css('overflow', 'hidden');
			}
			else if (sMessage.length <= 250 && sMessage.length > 100) {
				//var iTopPosition = 160;
				var iTopPosition = 130;
				$("div.MsgText").css('height', '150px');
				$("div.MsgText").css('overflow', 'hidden');
			}
			else {
				var iTopPosition = 80;
				$("div.MsgText").css('height', '200px');
				$("div.MsgText").css('overflow', 'auto');
			}
		}
		iTop = iTopPosition + iTopOffset;
		$("div.MsgTitle").text(sTitle);
		$("div.MsgText").html(sMessage);
		//$("#PopMsgWrapper .MsgText").html(sMessage);
		ButtonList = sButtons.split(',');
		$("div.MsgButtons").text('');
		for (var i=0; i<ButtonList.length; i++) {
			Fields = ButtonList[i].split(':');
			sButtonId = Fields[0];
			sButtonText = Fields[1];
			$("div.MsgButtons").append('<input type="button" id="' + sButtonId + '" value="' + sButtonText + '" class="Button"/>');
		}
		EffectInList = sEffectIn.split(',');
		sEffectInTxt = EffectInList[0];
		iEffectInTime = parseInt(EffectInList[1]);
		EffectOutList = sEffectOut.split(',');
		sEffectOutTxt = EffectOutList[0];
		iEffectOutTime = parseInt(EffectOutList[1]);
		if (sEffectInTxt == 'fadeIn') {
			$("div.PopMessage").fadeIn(iEffectInTime);
		}	
		$("div.Pops").css('left', iLeft + 'px');
		$("div.Pops").css('top', iTop + 'px');
		$("div.Pops").css('visibility','visible');
		if (sEffectOutTxt == 'fadeOut') {
			$("div.PopMessage").fadeOut(iEffectOutTime);
		}
		if (bFadeBackground) {
			$("#Wrapper").fadeTo("fast", 0.60);
		}
		if (functionShow) {
			functionShow($(this));
		}
	}

	function clickMsgOk(bFadeBackground, functionName) {
		bFadeOut = checkFadeOut();
		if (!bFadeOut) {
			bFadeBackground = false;
		}
		$(".Pops").css('left','-2000px');
		if (bFadeBackground) {
			$("#Wrapper").fadeTo("fast", 1.0);
		}
		if (functionName) {
			functionName();
		}
	}

	// Pop Up Message. It is used for Ajax actions, like OK Message, Error messages, etc...
	function showPopUp(messageOptions) {
		var sId = '';
		var sFadeOut = '';
		var sUrl = '';
		var sTitle = '';
		var sMessage = '';
		var iHeight = null;
		functionName = null;
		sId = messageOptions.id;
		sFadeOut = messageOptions.fadeout;
		bFadeOut = messageOptions.fadeBackground;
		sUrl = messageOptions.url;
		sTitle = messageOptions.title;
		sMessage = messageOptions.message;
		iHeight = messageOptions.height;
		functionName = messageOptions.functionName;
		if (!sFadeOut){
			sFadeOut = ''
			bFadeOut = true;
		}
		else {
			if (sFadeOut == '') {
				bFadeOut = true;
			}
			else {
				bFadeOut = false;
			}
		}
		bIE = checkIE();
		if (bIE) {
			bFadeOut = false;
		}
		// This is to prevent fadeouts in popups since Internet Explorer does not show frame border
		sFadeOut = '';
		showMessage({
			title: sTitle,
			message: sMessage,
			buttons: 'MsgOk:Close',
			effectIn: 'fadeIn,1000',
			effectOut: sFadeOut,
			fadeBackground: bFadeOut
		});
		//showMessage(sTitle, sMessage, 'MsgOk:OK', 'fadeIn,1000', sFadeOut, bFadeOut);
		if (sFadeOut == '') {
			$("#MsgOk").click(function() {clickMsgOk(bFadeOut, functionName)});
		}
		if (sUrl) {
			if (sUrl != '') {
				$("#MsgOk").click(function() {
					window.location = sUrl;
				});
			}
		}
   }
   
	// Pop Up Message Confirmation
	function showPopUpConfirmation(sId, functionName, element) {
		bIE = checkIE();
		if (bIE) {
			bFadeOut = false;
		}
		else {
			bFadeOut = true;
		}
		var MessageList = $("#" + sId).attr('value').split('::');
		sName = $(element).attr('name');
   		sTitle = MessageList[0];
		sTitle = sTitle.replace('$name', sName)
		sMessage = MessageList[1];
		sButtonOK = $("#sMsgConfirmOK").attr('value');
		sButtonCancel = $("#sMsgConfirmCancel").attr('value');
		showMessage(sTitle, sMessage, 'MsgOk:' + sButtonOK + ',MsgCancel:' + sButtonCancel, 'fadeIn,1000', '', bFadeOut);
		$("#MsgOk").click(function() {
			clickMsgOk(bFadeOut);
			functionName(element);
			//clickMsgOk(true);
		});
		$("#MsgCancel").click(function() {clickMsgOk(bFadeOut)});
   }
	
	// Confirmation ???????????????????
	function showConfirmation(sTitle, sMessage, sButtonText, sEffectIn, bFadeBackground) {
		iScreenWidth = document.body.clientWidth;
		iLeft = (iScreenWidth/2)- parseInt($("div.PopMessage").css('width'))/2;
		if (!$.browser.msie) {
			iTopOffset = window.pageYOffset;
		}
		else {
			iTopOffset = document.documentElement.scrollTop;
		}
		var iTopPosition = 160;
		iTop = iTopPosition + iTopOffset;
		$("div.MsgTitle").text(sTitle);
		$("div.MsgText").html(sMessage);
		ButtonTxtList = sButtonText.split(',');
		$("div.MsgButtons").text('');
		$("div.MsgButtons").append('<input type="button" id="MsgOk" value="' + ButtonTxtList[0] + '" class="Button"/>');
		$("div.MsgButtons").append('<input type="button" id="MsgCancel" value="' + ButtonTxtList[1] + '" class="Button"/>');
		EffectInList = sEffectIn.split(',');
		sEffectInTxt = EffectInList[0];
		iEffectInTime = parseInt(EffectInList[1]);
		if (sEffectInTxt == 'fadeIn') {
			$("div.PopMessage").fadeIn(iEffectInTime);
		}	
		$("div.Pops").css('left', iLeft + 'px');
		$("div.Pops").css('top', iTop + 'px');
		$("div.Pops").css('visibility','visible');
		if (bFadeBackground) {
			$("#Wrapper").fadeTo("fast", 0.60);
		}
	}
	
	function checkFadeOut() {
		if (jQuery.browser.msie) {
			bCheck = false;
		}
		else {
			bCheck = true;
		}
		return bCheck
	}
	
	function checkIE6() {
		if (jQuery.browser.msie && jQuery.browser.version.substr(0,3)=='6.0') {
			bIE6 = true;
		}
		else {
			bIE6 = false;
		}
		return bIE6;
	}

	function checkIE() {
		if (jQuery.browser.msie) {
			bIE = true;
		}
		else {
			bIE = false;
		}
		return bIE
	}
	
	showPasswordStrength('id_ximpiaId', 'id_password', 'id_Form1_Submit');
	
	//////////////////////////////////////////////////////////////////////////////////
	// InfoBubbles
	var bubbleOptions = {position : 'right',
						align	 : 'center',
						innerHtmlStyle: {color:'black', 'text-align':'center', 'font-size': '10pt'},
						themeName: 	'blue',
						themePath: 	'/site_media/images/jquerybubblepopup-theme'
	};
	$('.ImgInfo').CreateBubblePopup(bubbleOptions);
	$('.ImgInfo').mouseover(function() {
		var fieldList = $(this).attr('id').split('id_img_');
		var textId = 'id_msg_' + fieldList[1];
		var bubleText = $('#' + textId).attr('value');
		$(this).SetBubblePopupInnerHtml(bubleText, true);
	});
	/*$('input.Small').focus(function() {
		var name = $(this).attr('name');
        var textId = 'id_msg_' + name;
        var bubleText = $('#' + textId).attr('value');
		$('#' + 'id_img_' + name).SetBubblePopupInnerHtml(bubleText, true);
		$('#' + 'id_img_' + name).ShowBubblePopup();
	});
	$('input.Small').blur(function() {
		var name = $(this).attr('name');
        $('#' + 'id_img_' + name).HideBubblePopup();
    });*/
	///////////////////////////////////////////////////////////////////////	
	
	///////////////////////////////////////////////////////////////////////
	// Validation
	//jQuery.validator.messages.required = "";
	// Ximpia Generic Validations
	jQuery.validator.addMethod("ximpiaid", function(value, element) {
		return this.optional(element) || /^[a-zA-Z0-9_.]+$/i.test(value);
	}, "mensaje");
	jQuery.validator.addMethod("password", function(value, element) {
		return this.optional(element) || /^[a-zA-Z0-9$#!&%]+$/i.test(value);
	}, "mensaje");
	
	
	function doAfterSubmitOK() {
		showPopUp({
			title: 'We received your signup. Check your mail',
			message: '<table><tr><td style="vertical-align:top"><img src="/site_media/images/accepted_48.png" /></td>\
			<td style="vertical-align:top">We have received correctly your account signup. <p>We have sent an email to validate your \
			email address. Just click on link on Email message to activate your account.</p><p>Thanks!</p></td></tr></table>',
		});
	}
	
	// Form1
	submitForm('Form1', doAfterSubmitOK);
		
});

//Other

</script>

{% endblock %}

{% block title %}Ximpia - {% trans "Signup" %}{% endblock %}

{% block app %}

    <div id="app_Site" style="width: 100%; border: 0px solid" >
	
	<table id="SearchPadding"><tr><td style="width: 700px; padding-left: 30px;">
	
	{% if show_message %}
	<div id="ErrorMessage" style="background-color:#DDDDDD; padding:20px"><b>Message</b></div>
	{% endif %}

	<h3>XimpiaId</h3>
	
	<div class="FormBlock">
    <label for="id_ximpiaId">XimpiaId: {{form.ximpiaId}} <br />
	<label for="id_password">{% trans "Password" %}: {{form.password}} <br/>
	<label for="id_passwordVerify">{% trans "Password Verify" %}: {{form.passwordVerify}} <br />
	</div>

	<div id="UserData">	
	
	<h3>{% trans "About You" %}</h3>
	
	<div id="Info" class="FormBlock">
	<table border="0"><tr><td style="vertical-align: top">
	<label for="id_firstName">{% trans "First Name" %}: {{form.firstName}}<br />
	<label for="id_lastName">{% trans "Last Name" %}: {{form.lastName}}<br />
	<label for="id_email">Email: {{form.email}}<br />
	<label for="id_city">{% trans "City" %}: {{form.city}}<br />
	<label for="id_country">{% trans "Country" %}: {{form.country}}<br />	
	</td>
	<td style="vertical-align: top; padding-left: 50px">
	<label for="id_industry">{% trans "Industry" %}: {{form.industry}}<br />	
	</td>
	</tr></table>
	
	</div>
	
	</div>	
	
    <h3>{% trans "Social Networks" %}</h3>
    <div id="SocialNetworks" class="FormBlock">
    </div>
		
	{% if showInvitation %}
	<h3>{% trans "Invitation" %}</h3>
	<div id="Invitation" class="FormBlock">
		<label for="id_invitationCode">{% trans "Invitation Code" %}: {{form.invitationCode}}
	</div>
	{% endif %}
	
	<h3>{% trans "Validation" %}</h3>
	<div id="Invitation" class="FormBlock">
	<img src="/captcha/captcha.png" />
	<img id="id_refreshCaptcha" src="/site_media/images/refresh_48.png" class="Refresh" />
	<br />
	{{form.captcha}}
	</div>
	
	<br />
	<div id="buttonBarBottom" class="BtBar" style="border: 0px solid; width: 800px; background: #eeeeee ">
	<table style=" width: 100%" border="0"><tr>
	<td width="66%">
		<!-- Button Left -->
		<input id="id_Form1_Submit" type="button" value="{% trans "Signup" %}" class="Button submit" />
		<img id="id_Form1_Submit_Status" src="/site_media/images/blank.png" class="AjaxButton" />
		<span id="id_Form1_Submit_Text"></span>
	</td>
	<td width="33%" style="text-align: right;">
		<!-- Button Right -->
	</td>
	</tr></table>
	</div>
	
	<br /><br />
	
	</td>
		
	</tr>
	</table>
	
    
    </div>
    <!-- End app_MyApp -->

{% endblock %}


{% block hidden %}

{% for field in form %}
    {% if field.is_hidden %}
    {{field}}
	{% endif %}
{% endfor %}

{% endblock %}
